!function(e){"use strict";e.WS_Form.prototype.form_google_address=async function(){var o=this;if(!1===await this.form_google_maps_js_api_await("googleaddress"))return!1;await this.form_google_maps_js_api_import_libraries("googleaddress");var t=e("[data-google-address]:not([data-init-google-address])",this.form_canvas_obj);if(!t.length)return!1;t.each(function(){e(this).attr("data-init-google-address","");var t={},a=o.get_field_id(e(this)),r=o.get_field(e(this));t.field_id=a,t.id=e(this).attr("id"),t.obj=e(this),t.placeholder=o.get_object_meta_value(r,"placeholder",""),t.field_mapping=o.get_object_meta_value(r,"google_address_field_mapping",[]),t.map_field_id=o.get_object_meta_value(r,"google_address_map",""),t.map_zoom=parseInt(o.get_object_meta_value(r,"google_address_map_zoom","14"),10),t.map_geolocate_on_click=o.get_object_meta_value(r,"google_address_map_geolocate_on_click",""),t.map_geocode_location_snap=o.get_object_meta_value(r,"google_address_map_geocode_location_snap","on"),t.auto_complete=o.get_object_meta_value(r,"google_address_auto_complete",""),t.auto_complete_browser_timeout=parseInt(o.get_object_meta_value(r,"google_address_auto_complete_browser_timeout","5000")),isNaN(t.auto_complete_browser_timeout)&&(t.auto_complete_browser_timeout=5e3),t.auto_complete_browser_high_accuracy="on"==o.get_object_meta_value(r,"google_address_auto_complete_browser_high_accuracy",""),t.auto_complete_on_load=o.get_object_meta_value(r,"google_address_auto_complete_on_load",""),t.place_id_validation=o.get_object_meta_value(r,"google_address_place_id_validation","on");var _=o.get_object_meta_value(r,"google_address_place_id_invalid_message",o.language("google_address_place_id_invalid_message"));""==_&&(_=o.language("google_address_place_id_invalid_message")),t.place_id_invalid_message=_;var s=o.get_object_meta_value(r,"google_address_restriction_country",[]);if(t.restriction_country=[],"object"==typeof s&&s.length)for(var l in s)if(s.hasOwnProperty(l)){var n=s[l];n.country_alpha_2&&t.restriction_country.push(n.country_alpha_2)}switch(t.restriction_business=o.get_object_meta_value(r,"google_address_restriction_business",""),e.WS_Form.settings_plugin.google_maps_js_api_version){case"2":o.google_address_process(t);break;default:o.google_address_process_legacy(t)}})},e.WS_Form.prototype.google_address_process=function(o,t){var a=this,r={};switch("object"==typeof o.restriction_country&&o.restriction_country.length&&(r.includedRegionCodes=o.restriction_country),o.restriction_business){case"on":case"establishment":r.includedPrimaryTypes=["establishment"];break;case"address":case"(cities)":case"(regions)":r.includedPrimaryTypes=[o.restriction_business]}const _=new google.maps.places.PlaceAutocompleteElement(r);var s=_.Fg;if(s){var l=o.obj.attr("placeholder")?o.obj.attr("placeholder"):"";""==l&&(l=a.language("google_address_placeholder")),"string"==typeof s.placeholder&&(s.placeholder=l);const e=document.createElement("style");e.textContent=".widget-container .input-container input {\n\n\t// Base\n\t-webkit-appearance: none !important;\n\tcolor: var(--wsf-field-color) !important;\n\tfont-family: var(--wsf-field-font-family) !important;\n\tfont-size: var(--wsf-field-font-size) !important;\n\tfont-style: var(--wsf-field-font-style) !important;\n\tfont-weight: var(--wsf-field-font-weight) !important;\n\tletter-spacing: var(--wsf-field-letter-spacing) !important;\n\tline-height: var(--wsf-field-line-height) !important;\n\tmargin: 0 !important;\n\tpadding: 0 !important;\n\ttext-decoration: var(--wsf-field-text-decoration) !important;\n\ttext-size-adjust: 100% !important;\n\ttext-transform: var(--wsf-field-text-transform) !important;\n}\n\n.widget-container .input-container input::placeholder {\n\tcolor: var(--wsf-field-color-placeholder) !important;\n}\n\n.widget-container .autocomplete-icon,\n.widget-container .back-button,\n.widget-container .focus-ring,\n.widget-container .clear-button {\n\tdisplay: none !important;\n}",s.parentNode.insertBefore(e,s.nextSibling)}o.id_pac=o.id+"-pac",o.obj_pac_wrapper=e("#"+o.id_pac,a.form_canvas_obj),o.obj_pac_wrapper.append(_),o.obj_pac=e(_),o.obj.on("input change",function(t){if("object"==typeof o.obj_pac[0].Fg&&"string"==typeof o.obj_pac[0].Fg.value){var a=e(this).val(),r=a!=o.obj_pac[0].Fg.value;o.obj_pac[0].Fg.value=a,r&&o.obj_pac[0].Fg.dispatchEvent(new Event(t.type,{bubbles:!0}))}}),o.obj_pac.on("input change",function(e){if("object"==typeof o.obj_pac[0].Fg&&"string"==typeof o.obj_pac[0].Fg.value){var t=o.obj_pac[0].Fg.value,a=t!=o.obj.val();o.obj.val(t),a&&o.obj.trigger("change")}}),o.obj_pac.on("gmp-select",async function(e){var t=e.originalEvent.placePrediction.toPlace();await t.fetchFields({fields:["addressComponents","businessStatus","formattedAddress","nationalPhoneNumber","internationalPhoneNumber","location","displayName","id","plusCode","rating","userRatingCount","googleMapsURI","websiteURI"]}),t=a.place_legacy(t),a.google_address_place_set(o,t,!1)}),this.google_address_events(o)},e.WS_Form.prototype.google_address_process_legacy=function(e,o){var t=this,a={fields:["address_components","business_status","formatted_address","formatted_phone_number","geometry","international_phone_number","name","place_id","plus_code","rating","url","user_ratings_total","vicinity","website"]};switch(e.restriction_business){case"on":case"establishment":a.types=["establishment"];break;case"address":case"(cities)":case"(regions)":a.types=[e.restriction_business]}"object"==typeof e.restriction_country&&e.restriction_country.length&&(a.componentRestrictions={country:e.restriction_country}),new google.maps.places.Autocomplete(e.obj[0],a).addListener("place_changed",function(){var o=this.getPlace();t.google_address_place_set(e,o,!1)}),this.google_address_events(e)},e.WS_Form.prototype.google_address_events=function(o){var t=this;o.auto_complete_on_load&&this.google_address_auto_complete(o),o.place_id_validation&&o.obj.on("input",function(){t.google_address_validate(o)}),o.obj.on("wsf-auto-complete",function(){t.google_address_auto_complete(o)}),e(document).on("wsf-google-map-click wsf-google-map-dragend",function(e,a,r){t.google_address_map_field_match(o,a)&&t.google_address_geocode(o,r.lat(),r.lng(),!0)}),e(document).on("wsf-google-map-zoom-changed",function(e,a,r){t.google_address_map_field_match(o,a)&&(o.map_zoom=r)})},e.WS_Form.prototype.google_address_map_field_match=function(e,o){return o.field_id==e.map_field_id&&this.get_section_repeatable_suffix(o.obj)==this.get_section_repeatable_suffix(e.obj)},e.WS_Form.prototype.place_legacy=function(e){var o={};return e.addressComponents&&(o.address_components=e.addressComponents.map(function(e){return{long_name:e.longText||"",short_name:e.shortText||"",types:e.types||[]}})),e.location&&(o.geometry={location:{lat:function(){return e.location.lat()},lng:function(){return e.location.lng()}},viewport:e.viewport||null}),o.place_id=e.id||e.placeId||"",o.formatted_address=e.formattedAddress||"",o.formatted_phone_number=e.formattedPhoneNumber||"",o.international_phone_number=e.internationalPhoneNumber||"",o.name=e.displayName&&e.displayName.text?e.displayName.text:e.displayName||"",o.plus_code=e.plusCode||null,o.rating=e.rating||"",o.url=e.googleMapsUri||"",o.user_ratings_total=e.userRatingCount||"",o.vicinity=e.vicinity||"",o.website=e.websiteUri||"",o.business_status=e.businessStatus||"",o},e.WS_Form.prototype.google_address_validate=function(e){var o=e.obj;void 0!==o.attr("data-place-value-old")&&o.val()!==o.attr("data-place-value-old")&&o.attr("data-place-id")&&!o.attr("data-place-id-old")&&(o.attr("data-place-id-old",o.attr("data-place-id")),o.removeAttr("data-place-id").trigger("wsf-place-id-reset")),void 0!==o.attr("data-place-value-old")&&o.val()===o.attr("data-place-value-old")&&!o.attr("data-place-id")&&o.attr("data-place-id-old")&&(o.attr("data-place-id",o.attr("data-place-id-old")),o.removeAttr("data-place-id-old").trigger("wsf-place-id-set")),o.attr("data-place-id")?this.set_invalid_feedback(o,""):""!==o.val()?this.set_invalid_feedback(o,e.place_id_invalid_message):this.set_invalid_feedback(o,"")},e.WS_Form.prototype.google_address_place_set=function(o,t,a){var r=[];r.street_full_short="",r.street_full_long="",r.street_full_short_rev="",r.street_full_long_rev="",r.postal_code_full_short="",r.postal_code_full_long="";var _=this.get_section_repeatable_suffix(o.obj);for(var s in t.address_components)if(t.address_components.hasOwnProperty(s)){var l=t.address_components[s];for(var n in l.types){if(l.types.hasOwnProperty(n))switch(l.types[n]){case"street_number":r.street_number_short=l.short_name,r.street_number_long=l.long_name,r.street_full_short=l.short_name+" "+r.street_full_short,r.street_full_long=l.long_name+" "+r.street_full_long,r.street_full_short_rev+=l.short_name,r.street_full_long_rev+=l.long_name;break;case"route":r.route_short=l.short_name,r.route_long=l.long_name,r.street_full_short+=l.short_name,r.street_full_long+=l.long_name,r.street_full_short_rev=l.short_name+" "+r.street_full_short_rev,r.street_full_long_rev=l.long_name+" "+r.street_full_long_rev;break;case"locality":case"postal_town":r.locality_short=l.short_name,r.locality_long=l.long_name;break;case"sublocality":r.sublocality_short=l.short_name,r.sublocality_long=l.long_name;break;case"subpremise":r.subpremise_short=l.short_name,r.subpremise_long=l.long_name;break;case"neighborhood":r.neighborhood_short=l.short_name,r.neighborhood_long=l.long_name;break;case"administrative_area_level_1":r.aal1_short=l.short_name,r.aal1_long=l.long_name;break;case"administrative_area_level_2":r.aal2_short=l.short_name,r.aal2_long=l.long_name;break;case"postal_code":r.postal_code_short=l.short_name,r.postal_code_long=l.long_name,r.postal_code_full_short=l.short_name+r.postal_code_full_short,r.postal_code_full_long=l.long_name+r.postal_code_full_long;break;case"postal_code_suffix":r.postal_code_suffix_short=l.short_name,r.postal_code_suffix_long=l.long_name,r.postal_code_full_short=r.postal_code_full_short+"-"+l.short_name,r.postal_code_full_long=r.postal_code_full_long+"-"+l.long_name;break;case"country":r.country_short=l.short_name,r.country_long=l.long_name}}}if(t.geometry&&t.geometry.location){var i=t.geometry.location;r.lat=i.lat(),r.lng=i.lng(),r.lat_lng=i.lat()+","+i.lng()}t.plus_code&&t.plus_code.compound_code&&t.plus_code.global_code&&(r.plus_code_compound_code=t.plus_code.compound_code,r.plus_code_global_code=t.plus_code.global_code);var d=["business_status","formatted_address","formatted_phone_number","international_phone_number","name","place_id","rating","url","user_ratings_total","vicinity","website"];for(var c in o.obj.removeAttr("data-place-id"),d)if(d.hasOwnProperty(c)){var g=d[c];r[g]=t[g]?t[g]:"","place_id"===g&&r[g]&&(o.obj.attr("data-place-id",r[g]).removeAttr("data-place-id-old").trigger("wsf-place-id-set"),o.obj.attr("data-place-value-old",o.obj.val()))}if("object"==typeof o.field_mapping&&o.field_mapping.length)for(var p in o.field_mapping)if(o.field_mapping.hasOwnProperty(p)){var m=o.field_mapping[p],u=void 0!==m.google_address_component?m.google_address_component:"";if(""!=u){void 0===r[u]&&(r[u]="");var f=parseInt(void 0!==m.ws_form_field?m.ws_form_field:"",10);if(0!=f){var h=e("#"+this.form_id_prefix+"field-wrapper-"+f+_,this.form_canvas_obj),b=e("#"+this.form_id_prefix+"field-"+f+_,this.form_canvas_obj),v=r[u];this.field_value_set(h,b,v),b[0]===o.obj[0]&&o.obj.attr("data-place-value-old",v)}}}if((!a||o.map_geocode_location_snap)&&""!=o.map_field_id&&void 0!==this.google_maps[o.map_field_id+_]&&t.geometry&&t.geometry.location){var y=this.google_maps[o.map_field_id+_];y.marker_set_position(t.geometry.location,t),t.geometry.viewport&&y.map.fitBounds(t.geometry.viewport),o.map_zoom>0&&y.map.setZoom(o.map_zoom)}o.place_id_validation&&this.google_address_validate(o)},e.WS_Form.prototype.google_address_auto_complete=function(e){var o=this;switch(e.auto_complete){case"browser":if(!navigator.geolocation)break;"function"==typeof this.form_loader_show&&this.form_loader_show("geolocate"),navigator.geolocation.getCurrentPosition(function(t){o.google_address_geocode(e,parseFloat(t.coords.latitude),parseFloat(t.coords.longitude),!1),"function"==typeof o.form_loader_hide&&o.form_loader_hide()},function(e){e.message&&o.error("error_geocoder_google_address_error",e.message,"google-maps-js-api"),"function"==typeof o.form_loader_hide&&o.form_loader_hide()},{enableHighAccuracy:e.auto_complete_browser_high_accuracy,maximumAge:0,timeout:e.auto_complete_browser_timeout});break;case"ip":"function"==typeof this.form_loader_show&&this.form_loader_show("geolocate"),o.form_geo_get_element("lat_lng","","google_address_auto_complete_ip",{google_address:e})}},e.WS_Form.prototype.google_address_auto_complete_ip=function(e,o){if("function"==typeof this.form_loader_hide&&this.form_loader_hide(),!e||"string"!=typeof e)return!1;var t=e.split(",");if(2!==t.length)return!1;this.google_address_geocode(o.google_address,parseFloat(t[0]),parseFloat(t[1]),!1)},e.WS_Form.prototype.google_address_geocode=function(e,o,t,a){var r=this;const _=new google.maps.Geocoder;o=parseFloat(o),t=parseFloat(t);if(isNaN(o)||isNaN(t))return!1;const s={lat:o,lng:t};_.geocode({location:s}).then(o=>{if(o.results[0]){var t=o.results[0];r.log("log_google_geocode_success",t.place_id,"google-maps-js-api"),r.google_address_place_set(e,t,a)}else r.error("error_geocoder_google_address_no_results","google-maps-js-api")}).catch(e=>{r.error("error_geocoder_google_address_error",e)})}}(jQuery);