!function(e){"use strict";e.WS_Form.prototype.form_google_map=async function(){var o=this;if(!1===await this.form_google_maps_js_api_await("googlemap"))return!1;await this.form_google_maps_js_api_import_libraries("googlemap");var t=e("[data-google-map]:not([data-init-google-map])",this.form_canvas_obj);if(!t.length)return!1;this.google_maps=[],t.each(function(){e(this).attr("data-init-google-map","");var t=o.get_field_id(e(this)),a=o.get_field(e(this)),_={};_.field_id=t,_.id=e(this).attr("id"),_.id_map=_.id+"-map",_.id_map_google=o.get_object_meta_value(a,"google_map_id",_.id+"-map-google"),_.id_map_google||(_.id_map_google=_.id+"-map-google"),_.obj=e(this),_.obj_map=e("#"+_.id_map,o.form_canvas_obj),_.height=o.parse_variables_process(o.get_object_meta_value(a,"google_map_height","")).output,_.height&&_.obj_map.css({height:0,overflow:"hidden","padding-bottom":_.height,position:"relative"}),_.center=o.get_object_meta_value(a,"google_map_center",""),_.lat=o.parse_variables_process(o.get_object_meta_value(a,"google_map_lat","")).output,_.lng=o.parse_variables_process(o.get_object_meta_value(a,"google_map_lng","")).output,_.zoom=o.parse_variables_process(o.get_object_meta_value(a,"google_map_zoom","")).output,_.zoom?_.zoom=parseInt(_.zoom,10):_.zoom=14,_.type=o.get_object_meta_value(a,"google_map_type",""),_.type||(_.type="roadmap"),_.search_field_id=parseInt(o.get_object_meta_value(a,"google_map_search_field_id",0),10),_.marker_icon_title=o.parse_variables_process(o.get_object_meta_value(a,"google_map_marker_icon_title","")).output,_.marker_icon_url=o.parse_variables_process(o.get_object_meta_value(a,"google_map_marker_icon_url","")).output,_.routing_icon_url_origin=o.parse_variables_process(o.get_object_meta_value(a,"google_map_routing_icon_url_origin","")).output,_.routing_polyline_color=o.parse_variables_process(o.get_object_meta_value(a,"google_map_routing_polyline_color","#418fde")).output,_.routing_polyline_weight=parseInt(o.parse_variables_process(o.get_object_meta_value(a,"google_map_routing_polyline_weight",5)).output,10),0===_.routing_polyline_weight&&(_.routing_polyline_weight=5),_.control_type=""!==o.get_object_meta_value(a,"google_map_control_type","on"),_.control_full_screen=""!==o.get_object_meta_value(a,"google_map_control_full_screen","on"),_.control_street_view=""!==o.get_object_meta_value(a,"google_map_control_street_view","on"),_.control_zoom=""!==o.get_object_meta_value(a,"google_map_control_zoom","on");var r=o.get_section_repeatable_suffix(e(_.obj));o.google_maps[t+r]=_,o.google_map_process(_)})},e.WS_Form.prototype.google_map_process=function(o,t){var a=this;o.reposition=!0,o.obj.attr("data-default-value",o.obj.val()),o.geocoder=new google.maps.Geocoder,o.height&&o.obj_map.css({height:0,overflow:"hidden","padding-bottom":o.height,position:"relative"}),o.geolocate_process=function(e){o.geocoder.geocode({location:e},function(t,a){"OK"===a&&t[0]?(o.search_field_obj&&o.search_field_obj.val(t[0].formatted_address),o.marker_set_position(e,t[0])):(o.search_field_obj&&o.search_field_obj.val(""),o.marker_set_position(e))})},o.set_field_value=function(e){var t=JSON.stringify(e),a=o.obj.val()!==t;o.obj.val(t),a&&o.obj.trigger("change")},o.marker_set_position=function(e,t){var a={lat:e.lat(),lng:e.lng(),zoom:o.map.getZoom(),map_type_id:o.map.getMapTypeId()};t&&(a.place_id=t.place_id?t.place_id:"",t.plus_code&&(a.plus_code_compound_code=t.plus_code.compound_code?t.plus_code.compound_code:"",a.plus_code_global_code=t.plus_code.global_code?t.plus_code.global_code:""),a.address=t.formatted_address?t.formatted_address:"",a.name=t.name?t.name:"",t.address_components&&t.address_components.forEach(function(e){var o=e.types;-1!==o.indexOf("street_number")&&(a.street_number=e.long_name),-1!==o.indexOf("route")&&(a.street_name=e.long_name,a.street_name_short=e.short_name),-1!==o.indexOf("locality")&&(a.city=e.long_name),-1!==o.indexOf("administrative_area_level_1")&&(a.state=e.long_name,a.state_short=e.short_name),-1!==o.indexOf("postal_code")&&(a.post_code=e.long_name,a.post_code_short=e.short_name),-1!==o.indexOf("country")&&(a.country=e.long_name,a.country_short=e.short_name)})),o.set_field_value(a)},o.obj.on("change",function(){var t=e(this).val();try{var _=JSON.parse(t)}catch(a){var r=t.split(",");if(2===r.length){_={lat:r[0],lng:r[1]};void 0!==r[2]&&(_.zoom=r[2]),void 0!==r[3]&&(_.map_type_id=r[3]),e(this).val(JSON.stringify(_)),o.geolocate_process(new google.maps.LatLng(parseFloat(_.lat),parseFloat(_.lng)))}else _=!1}if(!1!==_){var i=new google.maps.LatLng(parseFloat(_.lat),parseFloat(_.lng));o.search_field_obj&&_.address&&_.address!=o.search_field_obj.val()&&o.search_field_obj.val(_.address),_.zoom&&_.zoom!=o.map.getZoom()&&o.map.setZoom(_.zoom),_.map_type_id&&_.map_type_id!=o.map.getMapTypeId()&&o.map.setMapTypeId(_.map_type_id)}else{i=!1;switch(o.center){case"browser":if(!navigator.geolocation)break;navigator.geolocation.getCurrentPosition(function(e){o.obj.val(parseFloat(e.coords.latitude)+","+parseFloat(e.coords.longitude)).trigger("change")});break;case"ip":a.form_geo_get_element("lat_lng","","form_geo_map_process",{field_id:o.field_id});break;default:if(o.lat&&o.lng)i=new google.maps.LatLng(parseFloat(o.lat),parseFloat(o.lng))}!1===i&&(i=new google.maps.LatLng(29.95,-90.08)),o.map.setZoom(o.zoom),o.map.setMapTypeId(o.type)}o.marker.position=i,o.reposition&&o.map.setCenter(i)});var _={clickableIcons:!1,fullscreenControl:o.control_full_screen,gestureHandling:"cooperative",mapId:o.id_map_google,mapTypeControl:o.control_type,mapTypeId:o.type,streetViewControl:o.control_street_view,zoom:o.zoom,zoomControl:o.control_zoom},r=new google.maps.Map(o.obj_map[0],_);o.map=r,o.directions_renderer=!1,o.map.addListener("zoom_changed",function(){var t=o.obj.val();if(""!=t){try{var a=JSON.parse(t)}catch(e){return}"object"==typeof a&&(a.zoom=o.map.getZoom(),o.set_field_value(a)),e(document).trigger("wsf-google-map-zoom-changed",[o,o.map.getZoom()])}}),o.map.addListener("maptypeid_changed",function(){var e=o.obj.val();if(""!=e){try{var t=JSON.parse(e)}catch(e){return}"object"==typeof t&&(t.map_type_id=o.map.getMapTypeId(),o.set_field_value(t))}}),o.map.addListener("click",function(t){o.reposition=!1;var a=t.latLng;o.marker_set_position(a),o.geolocate_process(a),e(document).trigger("wsf-google-map-click",[o,a])});var i={map:r,gmpDraggable:!0};if(o.marker_icon_url){var n=document.createElement("img");n.src=o.marker_icon_url,i.content=n}if(o.marker_icon_title&&(i.title=o.marker_icon_title),o.marker=new google.maps.marker.AdvancedMarkerElement(i),o.marker.addListener("dragend",function(t){o.reposition=!1;var a=t.latLng;o.geolocate_process(a),e(document).trigger("wsf-google-map-dragend",[o,a])}),o.obj.parent().find('[data-action="wsf-google-map-clear"]').on("click",function(e){e.preventDefault(),o.obj.val("").trigger("change")}),o.search_field_id){var l=a.get_section_repeatable_suffix(o.obj),s=parseInt(o.search_field_id,10),p=e('[id^="'+this.esc_selector(this.form_id_prefix+"field-"+s.toString()+l)+'"]',a.form_canvas_obj);if(l&&!p.length)p=e('[id^="'+this.esc_selector(a.form_id_prefix+"field-"+s.toString())+'"]',a.form_canvas_obj);if(p.length){o.search_field_obj=p;var g=p[0];o.search_box=new google.maps.places.SearchBox(g),o.map.addListener("bounds_changed",function(){o.search_box.setBounds(o.map.getBounds())}),o.search_box.addListener("places_changed",function(){o.reposition=!0;var e=o.search_box.getPlaces();0!=e.length&&e.forEach(function(e){e.geometry&&o.marker_set_position(e.geometry.location,e)})})}}o.obj.trigger("change")},e.WS_Form.prototype.place_legacy=function(e){var o={};return e.addressComponents&&(o.address_components=e.addressComponents.map(function(e){return{long_name:e.longText||"",short_name:e.shortText||"",types:e.types||[]}})),e.location&&(o.geometry={location:{lat:function(){return e.location.lat()},lng:function(){return e.location.lng()}},viewport:e.viewport||null}),o.place_id=e.id||e.placeId||"",o.formatted_address=e.formattedAddress||"",o.formatted_phone_number=e.formattedPhoneNumber||"",o.international_phone_number=e.internationalPhoneNumber||"",o.name=e.displayName&&e.displayName.text?e.displayName.text:e.displayName||"",o.plus_code=e.plusCode||null,o.rating=e.rating||"",o.url=e.googleMapsUri||"",o.user_ratings_total=e.userRatingCount||"",o.vicinity=e.vicinity||"",o.website=e.websiteUri||"",o.business_status=e.businessStatus||"",o}}(jQuery);